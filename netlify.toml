[build]
  # 构建设置
  publish = "."
  command = "echo 'Static site - no build required'"
  
  # 环境变量
  [build.environment]
    NODE_VERSION = "18"
    NPM_VERSION = "9"

# 重定向规则
[[redirects]]
  # SPA路由支持
  from = "/*"
  to = "/index.html"
  status = 200
  
  # API代理（如果需要）
  [[redirects]]
  from = "/api/*"
  to = "https://api.example.com/:splat"
  status = 200
  force = true

# 头部配置
[[headers]]
  # 全局安全头部
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self'; manifest-src 'self';"

[[headers]]
  # HTML文件缓存
  for = "*.html"
  [headers.values]
    Cache-Control = "public, max-age=3600, must-revalidate"

[[headers]]
  # CSS文件缓存
  for = "*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  # JavaScript文件缓存
  for = "*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  # 图片和字体缓存
  for = "/*.{jpg,jpeg,png,gif,webp,svg,woff,woff2,ttf,eot}"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  # PWA相关文件
  for = "/manifest.json"
  [headers.values]
    Cache-Control = "public, max-age=3600, must-revalidate"
    Content-Type = "application/manifest+json"

[[headers]]
  # Service Worker
  for = "/sw.js"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"
    Content-Type = "application/javascript"

# 构建优化
[build.processing]
  skip_processing = false
  
  [build.processing.css]
    bundle = true
    minify = true
    
  [build.processing.js]
    bundle = true
    minify = true
    
  [build.processing.html]
    pretty_urls = true
    
  [build.processing.images]
    compress = true

# 插件配置
[[plugins]]
  package = "@netlify/plugin-lighthouse"
  
  [plugins.inputs]
    budget_path = "./lighthouserc.json"

# 边缘函数（如果需要）
[edge_functions]
  directory = "netlify/edge"

# 部署上下文
[context.production]
  command = "echo 'Production build - no build required'"
  
[context.deploy-preview]
  command = "echo 'Preview build - no build required'"

[context.branch-deploy]
  command = "echo 'Branch deploy - no build required'"